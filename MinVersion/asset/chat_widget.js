function AddMessage(t){var e='<div class="chat-message clearfix"><img src="asset/gravatar.png" alt="" width="32" height="32"><div class="chat-message-content clearfix"><h5 style="width:83%; text-align:right;">You</h5><p style="text-align:right; margin-right:38px;">'+t+"</p></div></div><hr>";messages+=e}function AddMessageFromBot(t){var e='<div class="chat-message clearfix"><img style="float:left !important;" src="asset/bot_gravatar.png" alt="" width="32" height="32"><div class="chat-message-content clearfix"><h5>Deborah</h5><p>'+t+"</p></div></div><hr>";return messages+=e,e}function scrollToBottom(){var t=$(".chat-history");t.scrollTop(t.prop("scrollHeight"))}function generateToken(){var t="https://directline.botframework.com/v3/directline/conversations";$.ajax({url:t,type:"POST",data:"",headers:{Accept:"application/json",Authorization:"Bearer D9ngX-vYf0g.cwA.Rt0.RweRlmmFWptQFJPSya8Slry8M2iLaMyyjr-lBzrdqbQ"},success:function(t,e,s){conversationId=t.conversationId,returnedToken=t.token,streamUrl=t.streamUrl},error:function(t,e,s){console.log(s)}})}function SendMessage(t){var e="https://directline.botframework.com/v3/directline/conversations/"+conversationId+"/activities";$.ajax({url:e,type:"POST",dataType:"json",data:JSON.stringify({type:"message",from:{id:"user1"},text:t}),headers:{Accept:"application/json",Authorization:"Bearer "+returnedToken,"Content-Type":"application/json"},success:function(t,e,s){var i='<div class="chat-message clearfix typing"><img style="float:left !important;" src="asset/bot_gravatar.png" alt="" width="32" height="32"><div class="chat-message-content clearfix"><h5>Deborah</h5><p>typing...</p></div></div><hr>';$(".chat-history").append(i),scrollToBottom()},error:function(t,e,s){console.log(s)}})}function getBotResponse(){var t="https://directline.botframework.com/v3/directline/conversations/"+conversationId+"/activities";$.ajax({url:t,type:"GET",headers:{Accept:"application/json",Authorization:"Bearer "+returnedToken,"Content-Type":"application/json"},success:function(t,e,s){messages="";var i=10;if(t.activities.length>0){$.each(t.activities,function(t,e){"user1"==e.from.id?AddMessage(e.text):(AddMessageFromBot(e.text),i=e.text.length)});var a=0;void 0!=$(".typing").html()&&(a=$(".typing").html().length),(messages.length>$(".chat-history").html().length-a||9>i)&&($(".chat-history").html(messages),scrollToBottom())}},error:function(t,e,s){console.log(s)}})}var conversationId,returnedToken,streamUrl,messages;$(document).ready(function(){function t(t){var e=t.keyCode?t.keyCode:t.which;if(13==e){var s='<div class="chat-message clearfix"><img src="asset/gravatar.png" alt="" width="32" height="32"><div class="chat-message-content clearfix"><!--<span class="chat-time"></span>--><h5 style="width:83%; text-align:right;">You</h5><p style="text-align:right; margin-right:38px;">'+$("#txtMessage").val()+"</p></div></div><hr>";$(".chat-history").append(s),scrollToBottom(),SendMessage($("#txtMessage").val()),$("#txtMessage").val("")}}generateToken(),$("#live-chat header").on("click",function(){$(".chat").slideToggle(300,"swing"),$(".chat-message-counter").fadeToggle(300,"swing"),$(".quickActions").fadeToggle(100,"swing")}),setInterval(function(){void 0!=conversationId&&void 0!=returnedToken&&getBotResponse()},5e3),$("#txtMessage").click(function(){$("#actions").slideUp(),$("#btnAction").children("img").attr("src","asset/plus.png")}),$("#txtMessage").bind("keypress",{},t)}),$("#btnAction").click(function(){$("#actions").slideToggle(),$(".selected").children("ul").slideToggle(),$(".selected").removeClass("selected"),"asset/plus.png"==$(this).children("img").attr("src")?$(this).children("img").attr("src","asset/minus.png"):$(this).children("img").attr("src","asset/plus.png")}),$("#actions div").click(function(){"selected"!=$(this).attr("class")?($(this).children("ul").slideToggle(),$(".selected").not($(this)).children("ul").slideToggle(),$(".selected").removeClass("selected"),$(this).addClass("selected")):($(this).children("ul").slideToggle(),$(this).removeAttr("class"))}),$("#actions div ul li a").click(function(){$("#btnAction").children("img").attr("src","asset/plus.png");var t='<div class="chat-message clearfix"><img src="asset/gravatar.png" alt="" width="32" height="32"><div class="chat-message-content clearfix"><h5 style="width:79%; text-align:right;">You</h5><p style="text-align:right; margin-right:38px;">'+$(this).html()+"</p></div> <!-- end chat-message-content --></div><hr>";$(".chat-history").append(t),scrollToBottom(),SendMessage($(this).html()),$("#actions").slideUp()});