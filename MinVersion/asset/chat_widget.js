function AddMessage(e){var t='<div class="chat-message clearfix"><img src="asset/gravatar.png" alt="" width="32" height="32"><div class="chat-message-content clearfix"><!--<span class="chat-time"></span>--><h5 style="width:83%; text-align:right;">You</h5><p style="text-align:right; margin-right:38px;">'+e+"</p></div> <!-- end chat-message-content --></div> <!-- end chat-message --><hr>";messages+=t}function AddMessageFromBot(e){var t='<div class="chat-message clearfix"><img style="float:left !important;" src="asset/bot_gravatar.png" alt="" width="32" height="32"><div class="chat-message-content clearfix"><!--<span class="chat-time"></span>--><h5>Deborah</h5><p>'+e+"</p></div> <!-- end chat-message-content --></div> <!-- end chat-message --><hr>";return messages+=t,t}function scrollToBottom(){var e=$(".chat-history");e.scrollTop(e.prop("scrollHeight"))}function generateToken(){var e="https://directline.botframework.com/v3/directline/conversations";$.ajax({url:e,type:"POST",data:"",headers:{Accept:"application/json",Authorization:"Bearer D9ngX-vYf0g.cwA.Rt0.RweRlmmFWptQFJPSya8Slry8M2iLaMyyjr-lBzrdqbQ"},success:function(e,t,s){conversationId=e.conversationId,returnedToken=e.token,streamUrl=e.streamUrl},error:function(e,t,s){console.log(s)}})}function SendMessage(e){var t="https://directline.botframework.com/v3/directline/conversations/"+conversationId+"/activities";$.ajax({url:t,type:"POST",dataType:"json",data:JSON.stringify({type:"message",from:{id:userGuid},text:e}),headers:{Accept:"application/json",Authorization:"Bearer "+returnedToken,"Content-Type":"application/json"},success:function(e,t,s){var a='<div class="chat-message clearfix typing"><img style="float:left !important;" src="asset/bot_gravatar.png" alt="" width="32" height="32"><div class="chat-message-content clearfix"><!--<span class="chat-time"></span>--><h5>Deborah</h5><p>typing...</p></div> <!-- end chat-message-content --></div> <!-- end chat-message --><hr>';$(".chat-history").append(a),scrollToBottom()},error:function(e,t,s){console.log(s)}})}function getBotResponse(){var e="https://directline.botframework.com/v3/directline/conversations/"+conversationId+"/activities";$.ajax({url:e,type:"GET",headers:{Accept:"application/json",Authorization:"Bearer "+returnedToken,"Content-Type":"application/json"},success:function(e,t,s){messages="";var a=10;if(e.activities.length>0){$.each(e.activities,function(e,t){t.from.id==userGuid?AddMessage(t.text):(AddMessageFromBot(t.text),a=t.text.length)});var i=0;void 0!=$(".typing").html()&&(i=$(".typing").html().length),(messages.length>$(".chat-history").html().length-i||9>a)&&($(".chat-history").html(messages),scrollToBottom())}},error:function(e,t,s){console.log(s)}})}var conversationId,returnedToken,streamUrl,messages;$(document).ready(function(){function e(e){var t=e.keyCode?e.keyCode:e.which;if(13==t){var s='<div class="chat-message clearfix"><img src="asset/gravatar.png" alt="" width="32" height="32"><div class="chat-message-content clearfix"><!--<span class="chat-time"></span>--><h5 style="width:83%; text-align:right;">You</h5><p style="text-align:right; margin-right:38px;">'+$("#txtMessage").val()+"</p></div> <!-- end chat-message-content --></div> <!-- end chat-message --><hr>";$(".chat-history").append(s),scrollToBottom(),SendMessage($("#txtMessage").val()),$("#txtMessage").val("")}}generateToken(),$("#live-chat header").on("click",function(){$(".chat").slideToggle(300,"swing"),$(".chat-message-counter").fadeToggle(300,"swing"),$(".quickActions").fadeToggle(100,"swing")}),setInterval(function(){void 0!=conversationId&&void 0!=returnedToken&&getBotResponse()},5e3),$("#txtMessage").click(function(){$("#actions").slideUp(),$("#btnAction").children("img").attr("src","asset/plus.png")}),$("#txtMessage").bind("keypress",{},e)}),$("#btnAction").click(function(){$("#actions").slideToggle(),$(".selected").children("ul").slideToggle(),$(".selected").removeClass("selected"),"asset/plus.png"==$(this).children("img").attr("src")?$(this).children("img").attr("src","asset/minus.png"):$(this).children("img").attr("src","asset/plus.png")}),$("#actions div").click(function(){"selected"!=$(this).attr("class")?($(this).children("ul").slideToggle(),$(".selected").not($(this)).children("ul").slideToggle(),$(".selected").removeClass("selected"),$(this).addClass("selected")):($(this).children("ul").slideToggle(),$(this).removeAttr("class"))}),$("#actions div ul li a").click(function(){$("#btnAction").children("img").attr("src","asset/plus.png");var e='<div class="chat-message clearfix"><img src="asset/gravatar.png" alt="" width="32" height="32"><div class="chat-message-content clearfix"><!--<span class="chat-time"></span>--><h5 style="width:79%; text-align:right;">You</h5><p style="text-align:right; margin-right:38px;">'+$(this).html()+"</p></div> <!-- end chat-message-content --></div> <!-- end chat-message --><hr>";$(".chat-history").append(e),scrollToBottom(),SendMessage($(this).html()),$("#actions").slideUp()});