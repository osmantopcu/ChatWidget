function AddMessage(a){messages+='<div class="chat-message clearfix"><img src="asset/gravatar.png" alt="" width="32" height="32"><div class="chat-message-content clearfix"><!--<span class="chat-time"></span>--><h5 style="width:83%; text-align:right;">You</h5><p style="text-align:right; margin-right:38px;">'+a+"</p></div> <!-- end chat-message-content --></div> <!-- end chat-message --><hr>"}function AddMessageFromBot(a){var b='<div class="chat-message clearfix"><img style="float:left !important;" src="asset/bot_gravatar.png" alt="" width="32" height="32"><div class="chat-message-content clearfix"><!--<span class="chat-time"></span>--><h5>Deborah</h5><p>'+a+"</p></div> <!-- end chat-message-content --></div> <!-- end chat-message --><hr>";return messages+=b,b}function scrollToBottom(){var a=$(".chat-history");a.scrollTop(a.prop("scrollHeight"))}function generateToken(){$.ajax({url:"https://directline.botframework.com/v3/directline/conversations",type:"POST",data:"",headers:{Accept:"application/json",Authorization:"Bearer D9ngX-vYf0g.cwA.Rt0.RweRlmmFWptQFJPSya8Slry8M2iLaMyyjr-lBzrdqbQ"},success:function(a,b,c){conversationId=a.conversationId,returnedToken=a.token,streamUrl=a.streamUrl},error:function(a,b,c){console.log(c)}})}function SendMessage(a){var b="https://directline.botframework.com/v3/directline/conversations/"+conversationId+"/activities";$.ajax({url:b,type:"POST",dataType:"json",data:JSON.stringify({type:"message",from:{id:userGuid},text:a}),headers:{Accept:"application/json",Authorization:"Bearer "+returnedToken,"Content-Type":"application/json"},success:function(a,b,c){$(".chat-history").append('<div class="chat-message clearfix typing"><img style="float:left !important;" src="asset/bot_gravatar.png" alt="" width="32" height="32"><div class="chat-message-content clearfix"><!--<span class="chat-time"></span>--><h5>Deborah</h5><p>typing...</p></div> <!-- end chat-message-content --></div> <!-- end chat-message --><hr>'),scrollToBottom()},error:function(a,b,c){console.log(c)}})}function getBotResponse(){var a="https://directline.botframework.com/v3/directline/conversations/"+conversationId+"/activities";$.ajax({url:a,type:"GET",headers:{Accept:"application/json",Authorization:"Bearer "+returnedToken,"Content-Type":"application/json"},success:function(a,b,c){messages="";var d=10;if(a.activities.length>0){$.each(a.activities,function(a,b){if(b.from.id==userGuid)AddMessage(b.text);else if(console.log("item.text: "+b.text),console.log("item: ",JSON.stringify(b)),void 0!=b.text)AddMessageFromBot(b.text),d=b.text.length;else if(b.attachments.length>0)for(a=0;a<b.attachments.length;a++)AddMessageFromBot('<a href="'+b.attachments[a].contentUrl+'" target="_blank">'+b.attachments[a].contentUrl+"</a>")});var e=0;void 0!=$(".typing").html()&&(e=$(".typing").html().length),(messages.length>$(".chat-history").html().length-e||d<9)&&($(".chat-history").html(messages),scrollToBottom())}},error:function(a,b,c){console.log(c)}})}var conversationId,returnedToken,streamUrl,messages;$(document).ready(function(){function a(a){if(13==(a.keyCode?a.keyCode:a.which)){var c='<div class="chat-message clearfix"><img src="asset/gravatar.png" alt="" width="32" height="32"><div class="chat-message-content clearfix"><!--<span class="chat-time"></span>--><h5 style="width:83%; text-align:right;">You</h5><p style="text-align:right; margin-right:38px;">'+$("#txtMessage").val()+"</p></div> <!-- end chat-message-content --></div> <!-- end chat-message --><hr>";$(".chat-history").append(c),scrollToBottom(),SendMessage($("#txtMessage").val()),$("#txtMessage").val("")}}generateToken(),$("#live-chat header").on("click",function(){$(".chat").slideToggle(300,"swing"),$(".chat-message-counter").fadeToggle(300,"swing"),$(".quickActions").fadeToggle(100,"swing")}),setInterval(function(){void 0!=conversationId&&void 0!=returnedToken&&getBotResponse()},5e3),$("#txtMessage").click(function(){$("#actions").slideUp(),$("#btnAction").children("img").attr("src","asset/plus.png")}),$("#btnSend").click(function(){if(0!=$("#txtMessage").val().length){var a='<div class="chat-message clearfix"><img src="asset/gravatar.png" alt="" width="32" height="32"><div class="chat-message-content clearfix"><!--<span class="chat-time"></span>--><h5 style="width:83%; text-align:right;">You</h5><p style="text-align:right; margin-right:38px;">'+$("#txtMessage").val()+"</p></div> <!-- end chat-message-content --></div> <!-- end chat-message --><hr>";$(".chat-history").append(a),scrollToBottom(),SendMessage($("#txtMessage").val()),$("#txtMessage").val("")}}),$("#txtMessage").bind("keypress",{},a)}),$("#btnAction").click(function(){$("#actions").slideToggle(),$(".selected").children("ul").slideToggle(),$(".selected").removeClass("selected"),"asset/plus.png"==$(this).children("img").attr("src")?$(this).children("img").attr("src","asset/minus.png"):$(this).children("img").attr("src","asset/plus.png")}),$("#actions div").click(function(){"selected"!=$(this).attr("class")?($(this).children("ul").slideToggle(),$(".selected").not($(this)).children("ul").slideToggle(),$(".selected").removeClass("selected"),$(this).addClass("selected")):($(this).children("ul").slideToggle(),$(this).removeAttr("class"))}),$("#actions div ul li a").click(function(){$("#btnAction").children("img").attr("src","asset/plus.png");var a='<div class="chat-message clearfix"><img src="asset/gravatar.png" alt="" width="32" height="32"><div class="chat-message-content clearfix"><!--<span class="chat-time"></span>--><h5 style="width:79%; text-align:right;">You</h5><p style="text-align:right; margin-right:38px;">'+$(this).html()+"</p></div> <!-- end chat-message-content --></div> <!-- end chat-message --><hr>";$(".chat-history").append(a),scrollToBottom(),SendMessage($(this).html()),$("#actions").slideUp()});